{
  "comments": [
    {
      "key": {
        "uuid": "ecef97cd_7f126565",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 3239
      },
      "writtenOn": "2019-06-19T08:56:57Z",
      "side": 1,
      "message": "Same comment. Better to define POLICY_LOGS in policy-common-alpine Dockerfile and then use the same in child Dockerfile. Example - ${POLICY_LOGS}/api",
      "range": {
        "startLine": 5,
        "startChar": 16,
        "endLine": 5,
        "endChar": 37
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bbf5d22c_d22edeb5",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 477
      },
      "writtenOn": "2019-06-20T15:35:15Z",
      "side": 1,
      "message": "I think that would be problematic.  The problem is that POLICY_LOGS from parent image will obfuscate this one, and won\u0027t take effect.   It will also have side effects on the other images.  Perhaps a POLICY_BASE_LOGS in parent image, and have POLICY_LOGS defaulted here with that.   In any case, I don\u0027t think the change belongs to this review, and would have to be done on a different submission, so this one could proceed as is for this particular line at least for now.",
      "parentUuid": "ecef97cd_7f126565",
      "range": {
        "startLine": 5,
        "startChar": 16,
        "endLine": 5,
        "endChar": 37
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "cc142bc4_744bc054",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 5257
      },
      "writtenOn": "2019-06-21T08:00:54Z",
      "side": 1,
      "message": "ok, I will keep it unchanged.",
      "parentUuid": "bbf5d22c_d22edeb5",
      "range": {
        "startLine": 5,
        "startChar": 16,
        "endLine": 5,
        "endChar": 37
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b0d230f1_9bbeb6d9",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 5,
      "author": {
        "id": 3239
      },
      "writtenOn": "2019-06-25T08:54:41Z",
      "side": 1,
      "message": "Now we know that the earlier proposal of having variable in base image ($POLICY_HOME) and then use it in child ($POLICY_HOME/api) works. Should we re-consider the same for $POLICY_LOGS as well. May be raise a JIRA and do it as part of that and let this code merge. Thoughts?",
      "parentUuid": "cc142bc4_744bc054",
      "range": {
        "startLine": 5,
        "startChar": 16,
        "endLine": 5,
        "endChar": 37
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9afbce27_717f030b",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 159
      },
      "writtenOn": "2019-06-19T17:53:52Z",
      "side": 1,
      "message": "Same as the comment on the other patch:\n\nThe fabric8.io/docker-maven-plugin has filtering enabled by default. Properties that we want to replace are specified with the ${..} syntax and the replacement properties are specified through maven properties. Hence, in Dockerfile it is better to use ${..} only for ARGS that are supplied through properties for replacement, for all others we want to bypass this filtering hence remove the curly braces.\nFor example: check this patch out: https://gerrit.onap.org/r/#/c/policy/drools-applications/+/89204/8/controlloop/packages/docker-controlloop/src/main/docker/Dockerfile\nProperty BUILD_VERSION_APP_CL is supplied through properties for replacement in the file: https://gerrit.onap.org/r/#/c/policy/drools-applications/+/89204/8/controlloop/packages/docker-controlloop/pom.xml L47.",
      "range": {
        "startLine": 7,
        "startChar": 16,
        "endLine": 7,
        "endChar": 18
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "33596a4f_5cb35e99",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 477
      },
      "writtenOn": "2019-06-20T15:35:15Z",
      "side": 1,
      "message": "right, +1",
      "parentUuid": "9afbce27_717f030b",
      "range": {
        "startLine": 7,
        "startChar": 16,
        "endLine": 7,
        "endChar": 18
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a7a979f_1f885579",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 5257
      },
      "writtenOn": "2019-06-21T08:00:54Z",
      "side": 1,
      "message": "Will fix it.",
      "parentUuid": "33596a4f_5cb35e99",
      "range": {
        "startLine": 7,
        "startChar": 16,
        "endLine": 7,
        "endChar": 18
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7a102ad8_1cfdc982",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 3239
      },
      "writtenOn": "2019-06-19T08:56:57Z",
      "side": 1,
      "message": "Better to use ${POLICY_HOME}/api\nThat way if we want to change the base path of policy containers then it is just one change in policy-common-alpine Dockerfile.",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a70f8bb5_8eeb47da",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 477
      },
      "writtenOn": "2019-06-20T15:35:15Z",
      "side": 1,
      "message": "Here is the same issue as above with obfuscation from the parent image for POLICY_HOME.\n\nIn any case, the basic idea here is that if you go to any policy image you go to the location of your base software regardless of which container you are:\n\ncd $POLICY_LOGS # I see all the logs\ncd $POLICY_HOME # I see my base installation.\n\nNot sure if \"api\" directory is redundant with accessing the \"api\" container.  I don\u0027t recall the dir layout here.",
      "parentUuid": "7a102ad8_1cfdc982",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "265766ad_1fb4716f",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 5257
      },
      "writtenOn": "2019-06-21T08:00:54Z",
      "side": 1,
      "message": "Hi Jorge,\nDo you mean we\u0027d better to keep the POLICY_HOME as the parent image?\nIf so, I think the policy-api.sh should be updated, because it use the path /opt/app/policy/api as the location of base software now.",
      "parentUuid": "a70f8bb5_8eeb47da",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "173c3861_e5147237",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 477
      },
      "writtenOn": "2019-06-21T16:41:54Z",
      "side": 1,
      "message": "I think the issue that you may find here is that if POLICY_HOME is defined in the parent, if you build this image, and instantiate a container from it, if you do an \"echo $POLICY_HOME\", you\u0027ll see the parent one, in other words, you\u0027ll see \"/opt/app/policy\" and not \"/opt/app/policy/api\".  Give it a try if you can to verify it to make sure, at least that\u0027s the behavior I experienced before.",
      "parentUuid": "265766ad_1fb4716f",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b1c149d0_b9da9b42",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 5257
      },
      "writtenOn": "2019-06-24T08:06:45Z",
      "side": 1,
      "message": "Hi Jorge,\nI try as your suggestion, and the $POLICY_HOME is \"/opt/app/policy/api\".\nThe steps as below:\n1, build the image: mvn clean package docker:build\n2, start the container: docker run --entrypoint \"bash\" -it c34fd9ab1528\n3, check the $POLICY_HOME: echo $POLICY_HOME\noutput:\nbash-4.4$ echo $POLICY_HOME\n/opt/app/policy/api\n\nAnd the output of command `env` is:\n\nbash-4.4$ env\nPOLICY_HOME\u003d/opt/app/policy/api\nLANG\u003dC.UTF-8\nHOSTNAME\u003d307b918999f3\nJAVA_HOME\u003d/usr/lib/jvm/java-1.8-openjdk\nBUILD_VERSION\u003d1.4.0\nJAVA_VERSION\u003d8u201\nPWD\u003d/opt/app/policy/api/bin\nHOME\u003d/home/policy\nPOLICY_LOGS\u003d/var/log/onap/policy/api\nTERM\u003dxterm\nSHLVL\u003d1\nPATH\u003d/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/bin\nJAVA_ALPINE_VERSION\u003d8.201.08-r1\n_\u003d/usr/bin/env\nbash-4.4$ env\nPOLICY_HOME\u003d/opt/app/policy/api\nLANG\u003dC.UTF-8\nHOSTNAME\u003d307b918999f3\nJAVA_HOME\u003d/usr/lib/jvm/java-1.8-openjdk\nBUILD_VERSION\u003d1.4.0\nJAVA_VERSION\u003d8u201\nPWD\u003d/opt/app/policy/api/bin\nHOME\u003d/home/policy\nPOLICY_LOGS\u003d/var/log/onap/policy/api\nTERM\u003dxterm\nSHLVL\u003d1\nPATH\u003d/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/jvm/java-1.8-openjdk/jre/bin:/usr/lib/jvm/java-1.8-openjdk/bin\nJAVA_ALPINE_VERSION\u003d8.201.08-r1\n_\u003d/usr/bin/env\nbash-4.4$",
      "parentUuid": "173c3861_e5147237",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3cecf67f_128ae2e2",
        "filename": "packages/policy-api-docker/src/main/docker/Dockerfile",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 477
      },
      "writtenOn": "2019-06-24T15:06:53Z",
      "side": 1,
      "message": "Looks good!  Thanks for checking it out!",
      "parentUuid": "b1c149d0_b9da9b42",
      "range": {
        "startLine": 8,
        "startChar": 16,
        "endLine": 8,
        "endChar": 32
      },
      "revId": "d3fa88acd2e1eff97d49fcb2b7782e999a5df29a",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    }
  ]
}